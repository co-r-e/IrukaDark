<!--
  IrukaDark — (c) 2025 CORe Inc.
  License: AGPL-3.0-only. See https://github.com/co-r-e/IrukaDark/blob/HEAD/LICENSE
-->
<!doctype html>
<html lang="" class="theme-dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IrukaDark</title>
    <link rel="icon" type="image/svg+xml" href="assets/icons/favicon.svg" />
    <link rel="apple-touch-icon" href="assets/icons/favicon.svg" />
    <link href="./styles.css" rel="stylesheet" />
    <script src="./vendor/lucide-lite.js"></script>
    <script src="./i18n/base.js"></script>
    <script src="./i18n/lang/en.js"></script>
    <script src="./vendor/marked-lite.js"></script>
    <script src="./vendor/purify-lite.js"></script>
    <script src="./state/uiState.js"></script>
    <script src="./features/slashCommands.js"></script>
    <style>
      .clipboard-list {
        flex: 1;
        overflow-y: auto;
        padding: 8px;
        position: relative;
      }

      .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: #9ca3af;
        font-size: 14px;
      }

      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 12px;
        opacity: 0.5;
      }

      .context-menu {
        position: fixed;
        background: rgba(26, 20, 70, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 8px;
        padding: 0;
        min-width: 180px;
        max-width: 240px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 10000;
        display: none;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        overflow: hidden;
      }

      html:not(.theme-dark) .context-menu {
        background: rgba(255, 255, 255, 0.95);
        border-color: rgba(0, 0, 0, 0.12);
      }

      .context-menu-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 4px 8px;
        background: rgba(255, 255, 255, 0.05);
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        gap: 8px;
      }

      html:not(.theme-dark) .context-menu-header {
        background: rgba(0, 0, 0, 0.03);
        border-bottom-color: rgba(0, 0, 0, 0.08);
      }

      .context-menu-header-name {
        font-size: 10px;
        color: #9ca3af;
        font-weight: 500;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        flex: 1;
      }

      html:not(.theme-dark) .context-menu-header-name {
        color: #6b7280;
      }

      .context-menu-close {
        appearance: none;
        border: none;
        background: transparent;
        color: #9ca3af;
        font-size: 14px;
        line-height: 1;
        cursor: pointer;
        padding: 0;
        width: 16px;
        height: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 3px;
        transition: all 0.15s ease;
        flex-shrink: 0;
      }

      .context-menu-close:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #e5e7eb;
      }

      html:not(.theme-dark) .context-menu-close:hover {
        background: rgba(0, 0, 0, 0.05);
        color: #374151;
      }

      .context-menu-item {
        padding: 8px 12px;
        color: #e5e7eb;
        font-size: 12px;
        cursor: pointer;
        border-radius: 4px;
        transition: background 0.15s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .context-menu-item svg {
        flex-shrink: 0;
        display: block;
      }

      .context-menu-item span {
        flex: 1;
      }

      html:not(.theme-dark) .context-menu-item {
        color: #374151;
      }

      .context-menu-item:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      html:not(.theme-dark) .context-menu-item:hover {
        background: rgba(0, 0, 0, 0.05);
      }

      .context-menu-item.delete {
        color: #ff4d6d;
      }

      .clipboard-item-wrapper {
        background: transparent;
        border: none;
        border-radius: 8px;
        padding: 3px 8px;
        margin-bottom: 0;
        cursor: pointer;
        transition: all 0.15s ease;
        position: relative;
      }

      .clipboard-item-wrapper:hover {
        background: rgba(255, 255, 255, 0.08);
      }

      html:not(.theme-dark) .clipboard-item-wrapper:hover {
        background: rgba(0, 0, 0, 0.04);
      }

      .clipboard-item {
        display: flex;
        gap: 6px;
      }

      .clipboard-item-content {
        flex: 1;
        min-width: 0;
      }

      .clipboard-item-actions {
        display: flex;
        flex-direction: column;
        gap: 2px;
        flex-shrink: 0;
      }

      .clipboard-item-btn {
        appearance: none;
        border: none;
        background: transparent;
        color: #e5e7eb;
        font-size: 10px;
        padding: 4px;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.15s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .clipboard-item-btn svg {
        display: block;
      }

      html:not(.theme-dark) .clipboard-item-btn {
        background: transparent;
        color: #374151;
      }

      .clipboard-item-btn:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      html:not(.theme-dark) .clipboard-item-btn:hover {
        background: rgba(0, 0, 0, 0.08);
      }

      .clipboard-item-btn.delete {
        color: #ff4d6d;
      }

      .clipboard-item-btn.delete svg {
        stroke: #ff4d6d;
      }

      .clipboard-item-text {
        color: #e5e7eb;
        font-size: 11px;
        line-height: 1.3;
        word-wrap: break-word;
        white-space: pre-wrap;
        max-height: 40px;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      html:not(.theme-dark) .clipboard-item-text {
        color: #374151;
      }

      .clipboard-item-image {
        max-width: 100%;
        max-height: 40px;
        border-radius: 4px;
        object-fit: contain;
        display: block;
      }

      .snippet-folder {
        background: transparent;
        border: none;
        border-radius: 8px;
        padding: 3px 10px;
        margin-bottom: 1px;
        cursor: pointer;
        transition: all 0.15s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .snippet-folder:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      html:not(.theme-dark) .snippet-folder:hover {
        background: rgba(0, 0, 0, 0.03);
      }

      .snippet-folder-icon {
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #9ca3af;
      }

      .snippet-folder-icon svg {
        display: block;
      }

      .snippet-folder-count {
        color: #9ca3af;
        font-size: 11px;
      }

      .snippet-folder-name {
        color: #e5e7eb;
        font-size: 11px;
        font-weight: 500;
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        min-width: 0;
      }

      html:not(.theme-dark) .snippet-folder-name {
        color: #374151;
      }

      .snippet-folder-more {
        color: #9ca3af;
        font-size: 16px;
        cursor: pointer;
        padding: 2px 6px;
        border-radius: 4px;
        transition: all 0.15s ease;
        user-select: none;
        line-height: 1;
      }

      .snippet-folder-more:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #e5e7eb;
      }

      html:not(.theme-dark) .snippet-folder-more:hover {
        background: rgba(0, 0, 0, 0.05);
        color: #374151;
      }

      .snippet-folder-name-input {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 6px;
        padding: 4px 6px;
        color: #e5e7eb;
        font-size: 11px;
        font-weight: 500;
        outline: none;
        flex: 1;
        transition: all 0.15s ease;
      }

      .snippet-folder-name-input:focus {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.3);
      }

      html:not(.theme-dark) .snippet-folder-name-input {
        background: rgba(0, 0, 0, 0.03);
        border-color: rgba(0, 0, 0, 0.15);
        color: #374151;
      }

      html:not(.theme-dark) .snippet-folder-name-input:focus {
        background: rgba(0, 0, 0, 0.05);
        border-color: rgba(0, 0, 0, 0.2);
      }

      .snippet-item {
        background: transparent;
        border: none;
        border-radius: 8px;
        padding: 2px 8px;
        margin-bottom: 1px;
        cursor: pointer;
        transition: all 0.15s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .snippet-item.editing {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        cursor: default;
        background: rgba(255, 255, 255, 0.03);
        padding: 6px 8px;
      }

      html:not(.theme-dark) .snippet-item.editing {
        background: rgba(0, 0, 0, 0.02);
      }

      .snippet-item-name-input,
      .snippet-item-content-input {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 6px;
        padding: 6px 8px;
        color: #e5e7eb;
        font-size: 11px;
        outline: none;
        width: 100%;
        transition: all 0.15s ease;
      }

      .snippet-item-name-input:focus,
      .snippet-item-content-input:focus {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.3);
      }

      .snippet-item-content-input {
        min-height: 60px;
        resize: vertical;
        font-family: inherit;
        line-height: 1.4;
      }

      html:not(.theme-dark) .snippet-item-name-input,
      html:not(.theme-dark) .snippet-item-content-input {
        background: rgba(0, 0, 0, 0.03);
        border-color: rgba(0, 0, 0, 0.15);
        color: #374151;
      }

      html:not(.theme-dark) .snippet-item-name-input:focus,
      html:not(.theme-dark) .snippet-item-content-input:focus {
        background: rgba(0, 0, 0, 0.05);
        border-color: rgba(0, 0, 0, 0.2);
      }

      .snippet-item:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      html:not(.theme-dark) .snippet-item:hover {
        background: rgba(0, 0, 0, 0.03);
      }

      .snippet-item-name {
        color: #e5e7eb;
        font-size: 11px;
        font-weight: 500;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      html:not(.theme-dark) .snippet-item-name {
        color: #374151;
      }

      .snippet-item-more {
        color: #9ca3af;
        font-size: 16px;
        cursor: pointer;
        padding: 2px 6px;
        border-radius: 4px;
        transition: all 0.15s ease;
        user-select: none;
        line-height: 1;
        flex-shrink: 0;
      }

      .snippet-item-icon {
        width: 16px;
        height: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        opacity: 0;
        transition: opacity 0.2s ease;
      }

      .snippet-item-icon svg {
        display: block;
      }

      .snippet-item-content-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 4px;
        min-width: 0;
        overflow: hidden;
      }

      .add-folder-btn {
        background: transparent;
        border: none;
        color: #9ca3af;
        font-size: 11px;
        padding: 6px 10px;
        margin: 0;
        cursor: pointer;
        text-align: center;
        border-radius: 6px;
        transition: all 0.15s ease;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .add-folder-btn:hover {
        background: rgba(255, 255, 255, 0.05);
        color: #e5e7eb;
      }

      html:not(.theme-dark) .add-folder-btn:hover {
        background: rgba(0, 0, 0, 0.03);
        color: #374151;
      }

      .add-folder-btn svg {
        display: block;
        flex-shrink: 0;
      }

      .folder-content {
        padding-left: 24px;
        padding-top: 0;
        padding-bottom: 0;
      }

      /* Memo styles */
      .memo-textarea {
        width: 100%;
        height: 100%;
        border-radius: 8px;
        padding: 12px;
        font-size: 13px;
        line-height: 1.5;
        resize: none;
        outline: none;
        font-family: inherit;
        background: rgba(255, 255, 255, 0.05);
        border: none;
        color: #e5e7eb;
      }

      html:not(.theme-dark) .memo-textarea {
        background: rgba(0, 0, 0, 0.03);
        color: #111827;
      }

      .memo-textarea::placeholder {
        color: #6b7280;
      }

      html:not(.theme-dark) .memo-textarea::placeholder {
        color: #9ca3af;
      }

      .memo-textarea:focus {
        background: rgba(255, 255, 255, 0.08);
      }

      html:not(.theme-dark) .memo-textarea:focus {
        background: rgba(0, 0, 0, 0.05);
      }

      .memo-export-btn {
        appearance: none;
        border: none;
        background: transparent;
        color: #e5e7eb;
        padding: 6px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.15s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
      }

      html:not(.theme-dark) .memo-export-btn {
        background: transparent;
        color: #111827;
      }

      .memo-export-btn:hover {
        background: rgba(255, 255, 255, 0.12);
      }

      html:not(.theme-dark) .memo-export-btn:hover {
        background: rgba(0, 0, 0, 0.08);
      }

      .memo-export-btn svg {
        display: block;
        flex-shrink: 0;
      }

      /* Launcher styles */
      .launcher-results {
        flex: 1;
        overflow-y: auto;
        padding: 8px;
      }

      .launcher-result-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.15s;
        margin-bottom: 1px;
      }

      .launcher-result-item:hover,
      .launcher-result-item.selected {
        background: rgba(255, 255, 255, 0.08);
      }

      html:not(.theme-dark) .launcher-result-item:hover,
      html:not(.theme-dark) .launcher-result-item.selected {
        background: rgba(0, 0, 0, 0.05);
      }

      .launcher-result-icon {
        font-size: 16px;
        flex-shrink: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .launcher-app-icon {
        width: 24px;
        height: 24px;
        object-fit: contain;
        border-radius: 4px;
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
        image-rendering: pixelated;
      }

      .launcher-app-icon[src*='data:image'] {
        image-rendering: auto;
      }

      .launcher-svg-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
      }

      .launcher-svg-icon svg {
        width: 16px;
        height: 16px;
        flex-shrink: 0;
        color: currentColor;
      }

      .launcher-result-content {
        flex: 1;
        min-width: 0;
      }

      .launcher-result-title {
        font-size: 11px;
        font-weight: 500;
        color: #e5e7eb;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        line-height: 1.3;
      }

      html:not(.theme-dark) .launcher-result-title {
        color: #111827;
      }

      .launcher-result-subtitle {
        font-size: 9px;
        color: #9ca3af;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        margin-top: 1px;
        line-height: 1.2;
      }

      html:not(.theme-dark) .launcher-result-subtitle {
        color: #6b7280;
      }

      .launcher-result-type {
        font-size: 8px;
        color: #6b7280;
        text-transform: uppercase;
        flex-shrink: 0;
        padding: 2px 4px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 3px;
      }

      html:not(.theme-dark) .launcher-result-type {
        background: rgba(0, 0, 0, 0.05);
        color: #9ca3af;
      }

      .launcher-no-results {
        text-align: center;
        padding: 48px 16px;
        color: #9ca3af;
        font-size: 14px;
      }

      html:not(.theme-dark) .launcher-no-results {
        color: #6b7280;
      }

      .launcher-loading-indicator {
        text-align: center;
        padding: 12px;
        color: #9ca3af;
        font-size: 12px;
        opacity: 0.7;
      }

      html:not(.theme-dark) .launcher-loading-indicator {
        color: #6b7280;
      }

      /* Favorite button styles */
      .launcher-favorite-btn {
        appearance: none;
        border: none;
        background: transparent;
        cursor: pointer;
        padding: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        border-radius: 4px;
        transition: none;
      }

      .launcher-favorite-btn:hover {
        background: transparent;
      }

      .launcher-star-icon {
        color: #6b7280;
        transition:
          color 0.2s ease,
          fill 0.2s ease;
        flex-shrink: 0;
      }

      .launcher-star-icon.favorited {
        color: #fbbf24;
        fill: #fbbf24;
        stroke: #fbbf24;
      }

      html:not(.theme-dark) .launcher-star-icon {
        color: #9ca3af;
      }

      html:not(.theme-dark) .launcher-star-icon.favorited {
        color: #f59e0b;
        fill: #f59e0b;
        stroke: #f59e0b;
      }

      /* Filter styles */
      .filter-btn {
        appearance: none;
        border: none;
        background: transparent;
        color: #9ca3af;
        font-size: 11px;
        padding: 5px 8px;
        cursor: pointer;
        border-radius: 6px;
        transition: all 0.15s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .filter-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #e5e7eb;
      }

      html:not(.theme-dark) .filter-btn:hover {
        background: rgba(0, 0, 0, 0.05);
        color: #374151;
      }

      .filter-btn.active {
        background: linear-gradient(135deg, var(--primary), var(--primary-2));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .filter-btn.active svg {
        stroke: url(#filterPinkGradient);
      }

      .filter-btn svg {
        display: block;
      }

      .filter-menu {
        position: absolute;
        bottom: 40px;
        right: 8px;
        background: rgba(26, 20, 70, 0.98);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 8px;
        padding: 4px;
        box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        display: none;
        min-width: 140px;
      }

      html:not(.theme-dark) .filter-menu {
        background: rgba(255, 255, 255, 0.98);
        border-color: rgba(0, 0, 0, 0.12);
      }

      .filter-menu-item {
        padding: 8px 10px;
        color: #e5e7eb;
        font-size: 11px;
        cursor: pointer;
        border-radius: 4px;
        transition: background 0.15s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        user-select: none;
      }

      html:not(.theme-dark) .filter-menu-item {
        color: #374151;
      }

      .filter-menu-item:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      html:not(.theme-dark) .filter-menu-item:hover {
        background: rgba(0, 0, 0, 0.05);
      }

      .filter-checkbox {
        width: 14px;
        height: 14px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        flex-shrink: 0;
        transition: all 0.15s ease;
      }

      html:not(.theme-dark) .filter-checkbox {
        border-color: rgba(0, 0, 0, 0.3);
      }

      .filter-menu-item.active .filter-checkbox {
        background: #ff4d6d;
        border-color: #ff4d6d;
      }

      .filter-checkbox svg {
        display: block;
        color: white;
        width: 10px;
        height: 10px;
      }

      /* Confirmation Dialog */
      .confirmation-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 10001;
        backdrop-filter: blur(4px);
      }

      .confirmation-dialog {
        background: rgba(26, 20, 70, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 8px;
        padding: 0;
        min-width: 180px;
        max-width: 240px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      html:not(.theme-dark) .confirmation-dialog {
        background: rgba(255, 255, 255, 0.95);
        border-color: rgba(0, 0, 0, 0.12);
      }

      .confirmation-title {
        font-size: 12px;
        font-weight: 600;
        color: #e5e7eb;
        padding: 8px 12px;
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(255, 255, 255, 0.05);
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      }

      html:not(.theme-dark) .confirmation-title {
        color: #111827;
        background: rgba(0, 0, 0, 0.03);
        border-bottom-color: rgba(0, 0, 0, 0.08);
      }

      .confirmation-message {
        font-size: 11px;
        color: #9ca3af;
        padding: 12px;
        line-height: 1.5;
      }

      html:not(.theme-dark) .confirmation-message {
        color: #6b7280;
      }

      .confirmation-buttons {
        display: flex;
        gap: 6px;
        padding: 8px 12px;
        justify-content: flex-end;
        background: rgba(255, 255, 255, 0.03);
        border-top: 1px solid rgba(255, 255, 255, 0.08);
      }

      html:not(.theme-dark) .confirmation-buttons {
        background: rgba(0, 0, 0, 0.02);
        border-top-color: rgba(0, 0, 0, 0.08);
      }

      .confirmation-btn {
        appearance: none;
        border: none;
        padding: 4px 12px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.15s ease;
        flex: 1;
      }

      .confirmation-btn-cancel {
        background: rgba(255, 255, 255, 0.08);
        color: #e5e7eb;
      }

      html:not(.theme-dark) .confirmation-btn-cancel {
        background: rgba(0, 0, 0, 0.05);
        color: #374151;
      }

      .confirmation-btn-cancel:hover {
        background: rgba(255, 255, 255, 0.12);
      }

      html:not(.theme-dark) .confirmation-btn-cancel:hover {
        background: rgba(0, 0, 0, 0.08);
      }

      .confirmation-btn-confirm {
        background: linear-gradient(135deg, var(--primary), var(--primary-2));
        color: white;
      }

      .confirmation-btn-confirm:hover {
        opacity: 0.9;
      }

      /* Custom Drag & Drop Styles (Window-Constrained) */
      .snippet-folder:not(.editing),
      .snippet-item:not(.editing) {
        cursor: grab;
      }

      .snippet-folder.dragging,
      .snippet-item.dragging {
        opacity: 0.5;
        cursor: grabbing;
        transform: scale(0.95);
        transition: transform 0.1s ease;
      }

      .snippet-folder.drop-target,
      .snippet-item.drop-target {
        background: rgba(217, 70, 239, 0.15);
        box-shadow:
          inset 0 0 0 2px #d946ef,
          inset 0 0 8px rgba(217, 70, 239, 0.3);
        border-radius: 8px;
        transition: all 0.15s ease;
      }

      html:not(.theme-dark) .snippet-folder.drop-target,
      html:not(.theme-dark) .snippet-item.drop-target {
        background: rgba(217, 70, 239, 0.08);
        box-shadow:
          inset 0 0 0 2px #d946ef,
          inset 0 0 8px rgba(217, 70, 239, 0.2);
      }

      /* Disable dragging for editing mode */
      .snippet-folder.editing,
      .snippet-item.editing {
        cursor: default;
      }

      /* Prevent text selection during drag */
      body.dragging {
        user-select: none;
        -webkit-user-select: none;
      }

      /* Insertion line - macOS Notes style */
      .insertion-line {
        position: absolute;
        left: 8px;
        right: 8px;
        height: 2px;
        background: linear-gradient(90deg, #ff4d6d, #d946ef);
        border-radius: 1px;
        pointer-events: none;
        z-index: 1000;
        box-shadow: 0 0 4px rgba(217, 70, 239, 0.5);
      }

      /* Terminal styles */
      .terminal-container {
        display: flex;
        flex-direction: column;
        height: 100%;
        background: rgba(10, 10, 26, 0.95);
        overflow: hidden;
      }

      html:not(.theme-dark) .terminal-container {
        background: rgba(255, 255, 255, 0.95);
      }

      .terminal-tabs {
        display: flex;
        gap: 0;
        padding: 4px 8px;
        background: rgba(0, 0, 0, 0.3);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        overflow-x: auto;
        flex-shrink: 0;
      }

      html:not(.theme-dark) .terminal-tabs {
        background: rgba(0, 0, 0, 0.05);
        border-bottom-color: rgba(0, 0, 0, 0.1);
      }

      .terminal-tab {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 3px 6px;
        background: transparent;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.15s ease;
        flex-shrink: 0;
      }

      html:not(.theme-dark) .terminal-tab {
        background: transparent;
      }

      .terminal-tab:hover {
        background: transparent;
      }

      html:not(.theme-dark) .terminal-tab:hover {
        background: transparent;
      }

      .terminal-tab.active {
        background: transparent;
      }

      .terminal-tab-name {
        font-size: 10px;
        color: #9ca3af;
        font-weight: 500;
        user-select: none;
        transition: color 0.15s ease;
      }

      html:not(.theme-dark) .terminal-tab-name {
        color: #9ca3af;
      }

      .terminal-tab:hover .terminal-tab-name {
        color: #e5e7eb;
      }

      html:not(.theme-dark) .terminal-tab:hover .terminal-tab-name {
        color: #374151;
      }

      .terminal-tab.active .terminal-tab-name {
        color: #e5e7eb;
      }

      html:not(.theme-dark) .terminal-tab.active .terminal-tab-name {
        color: #0b1220;
      }

      .terminal-tab-menu-btn {
        appearance: none;
        background: transparent;
        border: none;
        color: #6b7280;
        font-size: 10px;
        line-height: 1;
        cursor: pointer;
        padding: 0;
        transition: color 0.15s ease;
        opacity: 0.6;
      }

      .terminal-tab:hover .terminal-tab-menu-btn,
      .terminal-tab.active .terminal-tab-menu-btn {
        opacity: 1;
      }

      .terminal-tab-menu-btn:hover {
        color: #e5e7eb;
      }

      html:not(.theme-dark) .terminal-tab-menu-btn:hover {
        color: #374151;
      }

      /* Terminal tab menu */
      .terminal-tab-menu {
        position: fixed;
        background: rgba(10, 10, 26, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 8px;
        padding: 4px;
        min-width: 140px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 10000;
        backdrop-filter: blur(8px);
      }

      html:not(.theme-dark) .terminal-tab-menu {
        background: rgba(255, 255, 255, 0.95);
        border-color: rgba(0, 0, 0, 0.12);
      }

      .terminal-tab-menu-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        color: #e5e7eb;
        font-size: 9px;
        cursor: pointer;
        border-radius: 4px;
        transition: background 0.15s ease;
      }

      html:not(.theme-dark) .terminal-tab-menu-item {
        color: #374151;
      }

      .terminal-tab-menu-item:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      html:not(.theme-dark) .terminal-tab-menu-item:hover {
        background: rgba(0, 0, 0, 0.05);
      }

      .terminal-tab-menu-item svg {
        flex-shrink: 0;
      }

      .terminal-tab-menu-item-danger {
        color: #ff4d6d;
      }

      .terminal-tab-menu-item-danger:hover {
        background: rgba(255, 77, 109, 0.1);
      }

      .terminal-content {
        flex: 1;
        position: relative;
        overflow: hidden;
        min-height: 0;
      }

      .terminal-instance {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        padding: 8px 8px 0 8px;
      }

      .terminal-instance .xterm {
        height: 100%;
        padding-bottom: 8px;
      }

      /* Terminal Footer */
      #terminalFooter {
        position: relative;
        background: rgba(10, 10, 26, 0.95);
      }

      html:not(.theme-dark) #terminalFooter {
        background: rgba(255, 255, 255, 0.95);
      }

      /* ========================================
         Terminal AI Command Input
         ======================================== */

      /* Footer container */
      .terminal-ai-footer {
        padding: 0 8px;
        margin: 0;
        width: 100%;
      }

      /* Input wrapper - centered with max-width */
      .terminal-ai-input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        width: 100%;
        margin: 0 auto;
      }

      /* Textarea input - auto-resizing with Enter/Shift+Enter support */
      .terminal-ai-input {
        width: 100%;
        min-height: 28px;
        max-height: 120px;
        padding: 6px 32px 6px 8px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 6px;
        color: #e5e7eb;
        font-size: 10px;
        font-family: inherit;
        line-height: 1.4;
        outline: none;
        resize: none;
        overflow-y: auto;
        transition: all 0.2s;
      }

      html:not(.theme-dark) .terminal-ai-input {
        border-color: rgba(0, 0, 0, 0.2);
        color: #111827;
      }

      .terminal-ai-input:focus {
        border-color: #ff4d6d;
      }

      .terminal-ai-input::placeholder {
        color: #9ca3af;
        white-space: nowrap;
      }

      html:not(.theme-dark) .terminal-ai-input::placeholder {
        color: #6b7280;
      }

      /* Submit button - Lucide ArrowUp icon */
      .terminal-ai-button {
        position: absolute;
        right: 6px;
        width: 22px;
        height: 22px;
        padding: 0;
        background: transparent;
        border: none;
        border-radius: 50%;
        color: #ffffff;
        font-size: 10px;
        line-height: 1;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }

      .terminal-ai-button:hover:not(:disabled) {
        transform: scale(1.1);
      }

      .terminal-ai-button:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }

      html:not(.theme-dark) .terminal-ai-button {
        color: #000000;
      }

      /* Drop target for nesting inside folder */
      .drop-target-nest {
        background: rgba(217, 70, 239, 0.08);
        box-shadow: inset 0 0 0 2px rgba(217, 70, 239, 0.4);
        border-radius: 8px;
      }

      html:not(.theme-dark) .drop-target-nest {
        background: rgba(217, 70, 239, 0.05);
        box-shadow: inset 0 0 0 2px rgba(217, 70, 239, 0.3);
      }
    </style>
  </head>

  <body class="glass-effect rounded-2xl shadow-2xl overflow-hidden">
    <div id="app" class="h-screen flex flex-col">
      <div class="titlebar" style="padding: 4px 8px">
        <div class="titlebar-tabs">
          <button
            id="chatTab"
            class="titlebar-tab active"
            data-tab="chat"
            data-i18n="clipboard.tabChat"
          >
            Chat
          </button>
          <button
            id="historyTab"
            class="titlebar-tab"
            data-tab="history"
            data-i18n="clipboard.tabHistory"
          >
            History
          </button>
          <button
            id="snippetTab"
            class="titlebar-tab"
            data-tab="snippet"
            data-i18n="clipboard.tabSnippet"
          >
            Snippet
          </button>
          <button
            id="launcherTab"
            class="titlebar-tab"
            data-tab="launcher"
            data-i18n="clipboard.tabLauncher"
          >
            Launcher
          </button>
          <button id="memoTab" class="titlebar-tab" data-tab="memo" data-i18n="clipboard.tabMemo">
            Memo
          </button>
          <button
            id="terminalTab"
            class="titlebar-tab"
            data-tab="terminal"
            data-i18n="terminal.tab"
          >
            Terminal
          </button>
          <button
            id="settingsTab"
            class="titlebar-tab"
            data-tab="settings"
            data-i18n="clipboard.tabSettings"
          >
            Settings
          </button>
        </div>
        <div class="titlebar-buttons"></div>
      </div>

      <!-- API Key Registration Form -->
      <div
        id="apiKeyForm"
        class="flex-1 flex items-center justify-center px-4 py-4"
        style="display: none"
      >
        <div class="api-key-form-container">
          <div class="api-key-form-header">
            <h2 class="api-key-form-title" data-i18n="apiKey.title">Welcome to IrukaDark</h2>
            <p class="api-key-form-description" data-i18n="apiKey.description">
              To start using IrukaDark, please register your Gemini API key.
            </p>
          </div>
          <div class="api-key-form-body">
            <input
              type="password"
              id="apiKeyInput"
              class="api-key-input"
              placeholder="Enter your Gemini API key"
              data-i18n-placeholder="apiKey.placeholder"
            />
            <button id="saveApiKeyBtn" class="api-key-save-btn" data-i18n="apiKey.save">
              Save and Continue
            </button>
            <p class="api-key-help-text">
              <a
                href="https://aistudio.google.com/app/api-keys"
                target="_blank"
                class="api-key-link"
              >
                <span data-i18n="apiKey.help">Get API key here</span>
                <svg
                  class="api-key-external-icon"
                  xmlns="http://www.w3.org/2000/svg"
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                  <polyline points="15 3 21 3 21 9"></polyline>
                  <line x1="10" y1="14" x2="21" y2="3"></line>
                </svg>
              </a>
            </p>
          </div>
        </div>
      </div>

      <div id="chatHistory" class="flex-1 overflow-y-auto px-4 py-4"></div>

      <!-- History List -->
      <div id="clipboardList" class="clipboard-list" style="display: none"></div>

      <!-- Snippet List -->
      <div id="snippetList" class="clipboard-list" style="display: none">
        <div class="empty-state">
          <div class="empty-state-icon">✂️</div>
          <div data-i18n="clipboard.noSnippetsYet">No snippets yet</div>
        </div>
      </div>

      <!-- Memo -->
      <div id="memoContainer" class="clipboard-list" style="display: none; padding: 8px">
        <textarea
          id="memoTextarea"
          class="memo-textarea"
          placeholder="Write your notes here..."
          data-i18n-placeholder="clipboard.memoPlaceholder"
        ></textarea>
      </div>

      <!-- Terminal -->
      <div id="terminalContainer" class="terminal-container" style="display: none">
        <div id="terminalTabs" class="terminal-tabs"></div>
        <div id="terminalContent" class="terminal-content"></div>
      </div>

      <!-- Launcher -->
      <div id="launcherContainer" class="clipboard-list" style="display: none; padding: 8px">
        <div id="launcherResults" class="launcher-results"></div>
      </div>

      <!-- Settings -->
      <div id="settingsContainer" class="clipboard-list" style="display: none; padding: 0">
        <div class="settings-content"></div>
      </div>

      <!-- Context Menu -->
      <div id="contextMenu" class="context-menu"></div>

      <!-- Search Results Mini Menu -->
      <div id="searchResultsMenu" class="search-results-menu" style="display: none"></div>

      <!-- Confirmation Dialog -->
      <div id="confirmationOverlay" class="confirmation-overlay">
        <div class="confirmation-dialog">
          <div class="confirmation-title">
            <span id="confirmationIcon">⚠️</span>
            <span id="confirmationTitleText" data-i18n="common.confirmAction">Confirm Action</span>
          </div>
          <div class="confirmation-message" id="confirmationMessage" data-i18n="common.areYouSure">
            Are you sure you want to proceed?
          </div>
          <div class="confirmation-buttons">
            <button
              class="confirmation-btn confirmation-btn-cancel"
              id="confirmationCancel"
              data-i18n="common.cancel"
            >
              Cancel
            </button>
            <button
              class="confirmation-btn confirmation-btn-confirm"
              id="confirmationConfirm"
              data-i18n="common.confirm"
            >
              Confirm
            </button>
          </div>
        </div>
      </div>

      <!-- Shortcut Change Popup -->
      <div id="shortcutChangePopup" class="shortcut-change-popup" style="display: none">
        <button class="shortcut-change-close" aria-label="Close">×</button>
        <div class="shortcut-change-content">
          <div class="shortcut-change-current">
            <div class="shortcut-change-label" data-i18n="settings.currentLabel">Current:</div>
            <div class="shortcut-change-current-key">Option+A</div>
          </div>
          <div class="shortcut-change-listening">
            <div class="shortcut-change-instruction" data-i18n="settings.popupInstruction">
              Press a key combination...
            </div>
            <div class="shortcut-change-preview"></div>
          </div>
          <button class="shortcut-change-apply-btn" data-i18n="settings.apply">Change</button>
        </div>
      </div>

      <!-- History Footer -->
      <div id="historyFooter" class="tab-footer" style="display: none">
        <div class="search-container">
          <svg
            class="search-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="12"
            height="12"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.3-4.3" />
          </svg>
          <input
            type="text"
            id="historySearchInput"
            class="search-input"
            placeholder="Search history..."
            data-i18n-placeholder="clipboard.searchHistory"
          />
          <button id="historyClearSearch" class="clear-search-btn" style="display: none">×</button>
        </div>
      </div>

      <!-- Snippet Footer -->
      <div id="snippetFooter" class="tab-footer" style="display: none">
        <div class="search-container">
          <svg
            class="search-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="12"
            height="12"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.3-4.3" />
          </svg>
          <input
            type="text"
            id="snippetSearchInput"
            class="search-input"
            placeholder="Search snippets..."
            data-i18n-placeholder="clipboard.searchSnippets"
          />
          <button id="snippetClearSearch" class="clear-search-btn" style="display: none">×</button>
        </div>
      </div>

      <!-- Memo Footer -->
      <div id="memoFooter" class="tab-footer" style="display: none">
        <div style="display: flex; justify-content: flex-end; width: 100%; gap: 8px">
          <button
            id="memoResetBtn"
            class="memo-export-btn"
            title="Reset"
            data-i18n-title="clipboard.resetMemo"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
              <path d="M21 3v5h-5" />
              <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
              <path d="M8 16H3v5" />
            </svg>
          </button>
          <button
            id="memoExportBtn"
            class="memo-export-btn"
            title="Copy"
            data-i18n-title="clipboard.copyMemo"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
              <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Terminal Footer -->
      <div id="terminalFooter" class="tab-footer" style="display: none"></div>

      <!-- Launcher Footer -->
      <div id="launcherFooter" class="tab-footer" style="display: none">
        <div style="display: flex; gap: 8px; align-items: center">
          <div class="search-container" style="flex: 1">
            <svg
              class="search-icon"
              xmlns="http://www.w3.org/2000/svg"
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.3-4.3" />
            </svg>
            <input
              type="text"
              id="launcherSearchInput"
              class="search-input"
              placeholder="Search apps, files..."
              data-i18n-placeholder="launcher.searchPlaceholder"
            />
          </div>
          <button id="launcherFilterBtn" class="filter-btn" title="Filter">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <defs>
                <linearGradient id="filterPinkGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color: #ff4d6d; stop-opacity: 1" />
                  <stop offset="100%" style="stop-color: #d946ef; stop-opacity: 1" />
                </linearGradient>
              </defs>
              <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />
            </svg>
          </button>
        </div>
        <!-- Filter Menu -->
        <div id="launcherFilterMenu" class="filter-menu">
          <div class="filter-menu-item active" data-filter="application">
            <div class="filter-checkbox">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="3"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="20 6 9 17 4 12" />
              </svg>
            </div>
            <span data-i18n="launcher.filterApp">App</span>
          </div>
          <div class="filter-menu-item active" data-filter="file">
            <div class="filter-checkbox">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="3"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="20 6 9 17 4 12" />
              </svg>
            </div>
            <span data-i18n="launcher.filterFile">File</span>
          </div>
          <div class="filter-menu-item active" data-filter="system-command">
            <div class="filter-checkbox">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="3"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="20 6 9 17 4 12" />
              </svg>
            </div>
            <span data-i18n="launcher.filterSystem">System</span>
          </div>
        </div>
      </div>

      <!-- Settings Footer -->
      <div id="settingsFooter" class="tab-footer" style="display: none">
        <div style="display: flex; justify-content: center; width: 100%; padding: 4px 0">
          <button
            id="resetAllShortcutsBtn"
            style="padding: 6px 16px; font-size: 10px; border-radius: 5px"
            data-i18n="settings.resetAll"
          >
            Reset to Defaults
          </button>
        </div>
      </div>

      <div
        id="inputArea"
        class="px-3 pt-4 pb-6 border-t border-white/15 bg-white/5 backdrop-blur-sm"
      >
        <div id="attachmentArea" class="attachment-area hidden"></div>
        <input
          type="file"
          id="fileInput"
          multiple
          accept="image/*,application/pdf,text/plain,text/markdown,.txt,.md,.csv,.json,.xml,.html,.css,.js,.py,.java,.cpp,.c,.h"
          style="display: none"
        />
        <div class="flex gap-0 items-end">
          <button
            id="plusBtn"
            class="plus-btn w-7 h-7 rounded-full transition-all duration-200 hover:scale-105 inline-flex items-center justify-center shadow-lg flex-shrink-0"
            data-i18n-title="addAttachment"
          >
            <svg
              class="plus-icon no-gradient"
              xmlns="http://www.w3.org/2000/svg"
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
            >
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </button>
          <div id="inputWrapper" class="flex-1 relative">
            <span id="inputCommandBadge" class="input-command-badge hidden">@image</span>
            <textarea
              id="messageInput"
              rows="1"
              placeholder=""
              data-i18n-placeholder="placeholder"
              class="w-full min-h-10 px-4 pr-8 py-2 pb-4 bg-white/60 backdrop-blur-md border border-white/30 rounded-lg text-sm placeholder:text-gray-500 focus:outline-none transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-sm resize-none overflow-y-auto"
            ></textarea>
            <button
              id="sendBtn"
              class="absolute right-2 bottom-2 w-10 h-10 rounded-full transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 inline-flex items-center justify-center shadow-lg"
              data-i18n-title="send"
            >
              <svg
                class="w-4 h-4 no-gradient"
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                aria-hidden="true"
              >
                <path d="M22 2L11 13"></path>
                <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div id="toast" class="toast-container"></div>

    <script src="./clipboard_renderer.js"></script>
    <script src="./launcher_renderer.js"></script>
    <script src="./terminal_renderer.js"></script>
    <script src="./settings_renderer.js"></script>
    <script>
      // Tab switching logic
      (function () {
        const chatTab = document.getElementById('chatTab');
        const historyTab = document.getElementById('historyTab');
        const snippetTab = document.getElementById('snippetTab');
        const launcherTab = document.getElementById('launcherTab');
        const memoTab = document.getElementById('memoTab');
        const terminalTab = document.getElementById('terminalTab');
        const settingsTab = document.getElementById('settingsTab');

        const chatHistory = document.getElementById('chatHistory');
        const clipboardList = document.getElementById('clipboardList');
        const snippetList = document.getElementById('snippetList');
        const memoContainer = document.getElementById('memoContainer');
        const terminalContainer = document.getElementById('terminalContainer');
        const launcherContainer = document.getElementById('launcherContainer');
        const settingsContainer = document.getElementById('settingsContainer');
        const historyFooter = document.getElementById('historyFooter');
        const snippetFooter = document.getElementById('snippetFooter');
        const memoFooter = document.getElementById('memoFooter');
        const terminalFooter = document.getElementById('terminalFooter');
        const launcherFooter = document.getElementById('launcherFooter');
        const settingsFooter = document.getElementById('settingsFooter');
        const inputArea = document.getElementById('inputArea');

        let clipboardUI = null;
        let memoUI = null;
        let terminalUI = null;
        let launcherUI = null;
        let settingsUI = null;

        function switchTab(tabName) {
          // Check if chat tab is already active and visible to prevent flashing
          const isChatAlreadyVisible =
            tabName === 'chat' &&
            chatTab.classList.contains('active') &&
            chatHistory.style.display === 'block';

          // Performance optimization: early return if chat tab is already active
          // BUT still check API key status to ensure consistency
          if (isChatAlreadyVisible) {
            // Even when already visible, verify API key state asynchronously without causing flicker
            if (window.app && window.app.checkApiKey) {
              window.app.checkApiKey().catch(() => {});
            }
            return; // Already on chat tab, minimal work needed
          }

          // Remove active class from all tabs
          chatTab.classList.remove('active');
          historyTab.classList.remove('active');
          snippetTab.classList.remove('active');
          launcherTab.classList.remove('active');
          memoTab.classList.remove('active');
          terminalTab.classList.remove('active');
          settingsTab.classList.remove('active');

          // Hide all views
          chatHistory.style.display = 'none';
          const apiKeyForm = document.getElementById('apiKeyForm');
          if (apiKeyForm) apiKeyForm.style.display = 'none';
          clipboardList.style.display = 'none';
          snippetList.style.display = 'none';
          memoContainer.style.display = 'none';
          terminalContainer.style.display = 'none';
          launcherContainer.style.display = 'none';
          settingsContainer.style.display = 'none';
          historyFooter.style.display = 'none';
          snippetFooter.style.display = 'none';
          memoFooter.style.display = 'none';
          terminalFooter.style.display = 'none';
          launcherFooter.style.display = 'none';
          settingsFooter.style.display = 'none';

          // Hide search results menu when switching tabs
          const searchResultsMenu = document.getElementById('searchResultsMenu');
          if (searchResultsMenu) {
            searchResultsMenu.style.display = 'none';
            searchResultsMenu.innerHTML = '';
          }

          // Show/hide input area and check API key for chat tab
          if (tabName === 'chat') {
            chatTab.classList.add('active');

            // Set initial display state before any async operations
            inputArea.style.display = 'block';

            // Show chat history immediately to prevent flicker, will be updated by API key check if needed
            if (chatHistory.style.display !== 'block') {
              chatHistory.style.display = 'block';
            }
            if (apiKeyForm && apiKeyForm.style.display !== 'none') {
              apiKeyForm.style.display = 'none';
            }

            // Adjust messageInput height
            if (window.app && window.app.autosizeMessageInput) {
              window.app.autosizeMessageInput();
            }

            // Check API key asynchronously without blocking UI
            if (window.app && window.app.checkApiKey) {
              window.app.checkApiKey().catch(() => {});
            }
          } else {
            inputArea.style.display = 'none';
            inputArea.classList.remove('invisible');

            if (tabName === 'history') {
              historyTab.classList.add('active');
              clipboardList.style.display = 'block';
              historyFooter.style.display = 'flex';

              // Initialize clipboard UI if not already done
              if (!clipboardUI) {
                clipboardUI = new ClipboardHistoryUI();
              }
              clipboardUI.currentTab = 'history';
              clipboardUI.switchTab('history');
            } else if (tabName === 'snippet') {
              snippetTab.classList.add('active');
              snippetList.style.display = 'block';
              snippetFooter.style.display = 'flex';

              // Initialize clipboard UI if not already done
              if (!clipboardUI) {
                clipboardUI = new ClipboardHistoryUI();
              }
              clipboardUI.currentTab = 'snippet';
              clipboardUI.switchTab('snippet');
            } else if (tabName === 'launcher') {
              launcherTab.classList.add('active');
              launcherContainer.style.display = 'block';
              launcherFooter.style.display = 'flex';

              // Initialize launcher UI if not already done
              if (!launcherUI) {
                launcherUI = new LauncherUI();
              } else {
                // Focus search input when switching to launcher tab
                const searchInput = document.getElementById('launcherSearchInput');
                if (searchInput) searchInput.focus();
              }
            } else if (tabName === 'memo') {
              memoTab.classList.add('active');
              memoContainer.style.display = 'block';
              memoFooter.style.display = 'flex';

              // Initialize memo UI if not already done
              if (!memoUI) {
                memoUI = new MemoUI();
              }
            } else if (tabName === 'terminal') {
              terminalTab.classList.add('active');
              terminalContainer.style.display = 'flex';
              terminalFooter.style.display = 'flex';

              // Initialize terminal UI if not already done
              if (!terminalUI) {
                terminalUI = new TerminalUI();
              } else {
                // Re-fit active terminal when switching to terminal tab
                if (terminalUI.activeTerminalId) {
                  const activeTerminal = terminalUI.terminals.get(terminalUI.activeTerminalId);
                  if (activeTerminal && activeTerminal.fitAddon) {
                    setTimeout(() => {
                      activeTerminal.fitAddon.fit();
                      activeTerminal.term.focus();
                    }, 50);
                  }
                }
              }
            } else if (tabName === 'settings') {
              settingsTab.classList.add('active');
              settingsContainer.style.display = 'block';
              settingsFooter.style.display = 'flex';

              // Initialize settings UI if not already done
              if (!settingsUI) {
                settingsUI = new SettingsUI();
              }
            }
          }
        }

        chatTab.addEventListener('click', () => switchTab('chat'));
        historyTab.addEventListener('click', () => switchTab('history'));
        snippetTab.addEventListener('click', () => switchTab('snippet'));
        launcherTab.addEventListener('click', () => switchTab('launcher'));
        memoTab.addEventListener('click', () => switchTab('memo'));
        terminalTab.addEventListener('click', () => switchTab('terminal'));
        settingsTab.addEventListener('click', () => switchTab('settings'));

        // Keyboard navigation for tabs
        const tabs = ['chat', 'history', 'snippet', 'launcher', 'memo', 'terminal', 'settings'];

        function getCurrentTabIndex() {
          if (chatTab.classList.contains('active')) return 0;
          if (historyTab.classList.contains('active')) return 1;
          if (snippetTab.classList.contains('active')) return 2;
          if (launcherTab.classList.contains('active')) return 3;
          if (memoTab.classList.contains('active')) return 4;
          if (terminalTab.classList.contains('active')) return 5;
          if (settingsTab.classList.contains('active')) return 6;
          return 0; // Default to chat
        }

        function scrollTabIntoView(tabName) {
          const tabElement =
            tabName === 'chat'
              ? chatTab
              : tabName === 'history'
                ? historyTab
                : tabName === 'snippet'
                  ? snippetTab
                  : tabName === 'launcher'
                    ? launcherTab
                    : tabName === 'memo'
                      ? memoTab
                      : tabName === 'terminal'
                        ? terminalTab
                        : settingsTab;

          if (tabElement) {
            tabElement.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
          }
        }

        window.addEventListener('keydown', (e) => {
          // Check if the target is an input, textarea, or contenteditable element
          const target = e.target;
          const isEditable =
            target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable;

          // Only handle Tab key for tab navigation
          if (e.key === 'Tab') {
            const currentIndex = getCurrentTabIndex();
            let nextIndex;

            if (e.shiftKey) {
              // Shift + Tab: Move to previous tab
              nextIndex = (currentIndex - 1 + tabs.length) % tabs.length;
            } else {
              // Tab: Move to next tab
              nextIndex = (currentIndex + 1) % tabs.length;
            }

            const nextTab = tabs[nextIndex];
            e.preventDefault();
            switchTab(nextTab);
            scrollTabIntoView(nextTab);
          }
        });

        // Expose switchTab globally so it can be called from app.js
        window.switchToTab = switchTab;
      })();
    </script>
    <script src="./app.js"></script>
  </body>
</html>
