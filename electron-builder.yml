appId: com.core.irukadark
productName: 'IrukaDark'
# PERFORMANCE: Enable asar archive for faster file access
asar: true
# PERFORMANCE: Unpack native modules for optimal performance
asarUnpack:
  - '**/*.node'
  - 'native/**/*'
# PERFORMANCE: Use normal compression for faster load times
# (maximum compression saves space but slows down asar extraction)
compression: normal
files:
  - 'src/**/*'
  - '!**/*.map'
  - '!**/docs/**'
  - '!**/tests/**'
  - '!**/.github/**'
  - '!**/*.md'
  - '!**/.DS_Store'
extraResources:
  # macOS automation bridge
  - from: native/macos/IrukaAutomation/dist
    to: mac-automation
    filter:
      - 'IrukaAutomation'
  # Windows automation bridge
  - from: native/windows/IrukaAutomation/dist
    to: win-automation
    filter:
      - 'IrukaAutomation.exe'
mac:
  target:
    - target: dmg
      arch: [x64, arm64]
    - target: zip
      arch: [x64, arm64]
  # Electron 38+ requires macOS 12 (Monterey) or later
  # macOS 11 (Big Sur) support was dropped in Electron 38
  minimumSystemVersion: '12.0.0'
  hardenedRuntime: true
  entitlements: build/entitlements.mac.plist
  entitlementsInherit: build/entitlements.mac.plist
  icon: src/renderer/assets/icons/icon.png
dmg:
  artifactName: '${productName}-${version}-mac-${arch}.dmg'
win:
  target:
    - target: nsis
      arch: [x64]
  # Windows 10 1809+ (build 17763)
  artifactName: '${productName}-${version}-win-${arch}.${ext}'
nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  deleteAppDataOnUninstall: false
publish:
  - provider: github
    releaseType: release
afterSign: build/after-sign.js
