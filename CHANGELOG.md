# Changelog

すべての重要な変更はこのファイルに記録します。

## v1.0.21 (2025-10-13)

### Fixed

- 配布版で Option/Alt+`A` 等のショートカットが無反応になる問題を修正。Swift ヘルパーを electron-builder の `afterSign` で確実に署名し、TCC(アクセシビリティ)が一貫して認識するようにしました。
- Swift ヘルパーを Universal2（arm64 + x86_64）に統一。x64 配布で arm64 専用ヘルパーが同梱される問題を解消。
- ショートカットとブリッジ呼び出しの詳細ログを `~/Library/Logs/IrukaDark/automation.log` に出力。

### Changed

- 初回起動でヘルパーの `ensure-accessibility` を非同期実行し、OS の許可ダイアログを早期に提示。

## v1.0.17 (2025-10-03)

- URLサマリー系ショートカット（Option+1 / Option+Shift+1）がアプリ内でURLを取得・整形してからGeminiへ渡すパイプラインに刷新。URL Context API依存を廃止し、言語別テンプレートと長文トリミング時の注意書きを追加。
- SNS下書きショートカット（Control+Option+1）が同じ整形フローを再利用し、UI言語とトーンに応じて自然な投稿を生成するよう改善。
- メインプロセスで同一プロンプトのテキスト／画像リクエストを5分間キャッシュし、GenAIクライアントのTTLを設けて不要なAPI呼び出しとリソース消費を抑制。
- ショートカット起動時にウィンドウを即座に表示し、macOSのコピー待機を調整してOption+A / Option+1系の取りこぼしを改善。
- レンダラー側でi18n対象要素をキャッシュし、失敗時のエラー提案を詳細化してUIのもたつきを軽減。

## v1.0.16 (2025-10-01)

- URL系ショートカット（Option+1 / Option+Shift+1）を全面刷新。対象ページをアプリ側で取得し、script/style 除去＋改行整形したテキストを Gemini へ渡すパイプラインに切り替え、URL Context API 依存を排除。
- SNS下書きショートカット（Control+Option+1）も同じ抽出ロジックを共用し、整形済みコンテンツをプロンプトに埋め込むよう統一。
- メインプロセス／AI ラッパーから URL Context 特有のブリッジ処理を削除し、Web Search オプションのみをサポート。
- README を更新し、新しい URL フローと参照バッジ挙動の変更を反映。

## v1.0.15 (2025-10-01)

- ショートカット: Control+Option+1 で選択中の URL から SNS 向けの下書きを即生成（無効な選択はエラートーストで通知）。
- ショートカット: Control+Option+Z で選択テキストへ寄り添う共感コメントを生成。入力言語を自動判定し、各言語で自然な一文を返します。
- クリップボード: macOS の選択テキスト取得をアクセシビリティ API 先読みと `⌘+C` ポーリングの併用に整理。ウィンドウの一時非表示→復帰も自動化し、コピー成功率を改善。
- UI: システムメッセージの改行を保持表示。新ショートカットに合わせたトースト通知と多言語ラベルを追加。

## v1.0.8 (2025-09-15)

- ショートカット: クリップボードの鮮度判定（`isClipboardTextStale`）を廃止。非空テキストのみ失敗扱いに変更。
- 背景監視: クリップボード監視ポーリング（`startClipboardWatcher`）を削除して微小にCPU/省電力を改善。
- AI設定: prefs に API キーが保存済みの場合、入力ダイアログでマスキング表示（保存済みが分かるプレースホルダー）を追加。
- リファクタ: 未使用コード・コメントの整理、lint 警告を解消。

互換性: 破壊的変更なし（旧「鮮度」依存の挙動のみ削除）。
